# è´¢åŠ¡æ¨¡å—è·¯ç”±å’Œè¯·æ±‚éªŒè¯

## âœ… è·¯ç”±éªŒè¯å¯¹ç…§è¡¨

### 1. GET /api/transactionsï¼ˆè·å–äº¤æ˜“è®°å½•åˆ—è¡¨ï¼‰

**éœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼š**
- æŸ¥è¯¢å‚æ•°ï¼š`date`, `type`, `category`, `month`, `page`, `limit`
- å“åº”æ ¼å¼ï¼š`{"data": [...]}` ï¼ˆæ•°ç»„æ ¼å¼ï¼Œä¸å«åˆ†é¡µä¿¡æ¯ï¼‰

**å½“å‰å®ç°ï¼š**
- âœ… è·¯ç”±ï¼š`GET /api/transactions`
- âœ… æŸ¥è¯¢å‚æ•°ï¼šå…¨éƒ¨æ”¯æŒ
  - `date` (Optional[str]): æ—¥æœŸè¿‡æ»¤ YYYY-MM-DD
  - `type` (Optional[str]): ç±»å‹è¿‡æ»¤ income/expense
  - `category` (Optional[str]): ç±»åˆ«è¿‡æ»¤
  - `month` (Optional[str]): æœˆä»½è¿‡æ»¤ YYYY-MM
  - `page` (int): é¡µç ï¼Œé»˜è®¤1ï¼Œ>=1
  - `limit` (int): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤100ï¼Œ>=1ï¼Œ<=500
- âœ… å“åº”æ ¼å¼ï¼š`{"data": [...]}` ï¼ˆå·²ä¿®å¤ï¼Œç›´æ¥è¿”å›æ•°ç»„ï¼‰
- âœ… è®¤è¯ï¼šéœ€è¦Bearer Token
- âœ… ç”¨æˆ·éš”ç¦»ï¼šåªè¿”å›å½“å‰ç”¨æˆ·çš„è®°å½•

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "data": [
    {
      "id": 1,
      "type": "expense",
      "amount": 45.50,
      "category": "é¤é¥®",
      "description": "åˆé¤",
      "date": "2025-10-28",
      "time": "12:30:00"
    }
  ]
}
```

---

### 2. GET /api/transactions/{transaction_id}ï¼ˆè·å–å•æ¡äº¤æ˜“è®°å½•ï¼‰

**éœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼š**
- è·¯å¾„å‚æ•°ï¼š`transaction_id` (å¿…éœ€)
- å“åº”æ ¼å¼ï¼š`{"data": {...}}`
- é”™è¯¯ï¼š404 å¦‚æœä¸å­˜åœ¨

**å½“å‰å®ç°ï¼š**
- âœ… è·¯ç”±ï¼š`GET /api/transactions/{transaction_id}`
- âœ… è·¯å¾„å‚æ•°ï¼š`transaction_id` (int)
- âœ… å“åº”æ ¼å¼ï¼š`{"data": {...}}`
- âœ… é”™è¯¯å¤„ç†ï¼š404 "äº¤æ˜“è®°å½•ä¸å­˜åœ¨"
- âœ… è®¤è¯ï¼šéœ€è¦Bearer Token
- âœ… ç”¨æˆ·éš”ç¦»ï¼šåªèƒ½è®¿é—®è‡ªå·±çš„è®°å½•

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "data": {
    "id": 1,
    "type": "expense",
    "amount": 45.50,
    "category": "é¤é¥®",
    "description": "åˆé¤",
    "date": "2025-10-28",
    "time": "12:30:00"
  }
}
```

---

### 3. POST /api/transactionsï¼ˆåˆ›å»ºäº¤æ˜“è®°å½•ï¼‰

**éœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼š**
- è¯·æ±‚ä½“å­—æ®µï¼š
  - `type` (å¿…éœ€): income/expense
  - `amount` (å¿…éœ€): å¿…é¡» > 0
  - `category` (å¿…éœ€): ç±»åˆ«
  - `description` (å¿…éœ€): æœ€å¤§255å­—ç¬¦
  - `date` (å¿…éœ€): YYYY-MM-DD
  - `time` (å¯é€‰): HH:MM æˆ– HH:MM:SS
- å“åº”æ ¼å¼ï¼š`{"message": "...", "data": {...}}`
- çŠ¶æ€ç ï¼š201

**å½“å‰å®ç°ï¼š**
- âœ… è·¯ç”±ï¼š`POST /api/transactions`
- âœ… çŠ¶æ€ç ï¼š201
- âœ… è¯·æ±‚ä½“éªŒè¯ï¼š
  - `type`: éªŒè¯å¿…é¡»æ˜¯ income æˆ– expense
  - `amount`: å¿…é¡» > 0
  - `description`: æœ€å¤§255å­—ç¬¦
  - `date`: æ ¼å¼éªŒè¯ YYYY-MM-DD
  - `time`: å¯é€‰ï¼Œæ”¯æŒ HH:MM æˆ– HH:MM:SS æ ¼å¼
- âœ… å“åº”æ ¼å¼ï¼š`{"message": "äº¤æ˜“è®°å½•åˆ›å»ºæˆåŠŸ", "data": {...}}`
- âœ… è®¤è¯ï¼šéœ€è¦Bearer Token
- âœ… ç”¨æˆ·éš”ç¦»ï¼šè‡ªåŠ¨å…³è”å½“å‰ç”¨æˆ·

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "type": "expense",
  "amount": 30.00,
  "category": "äº¤é€š",
  "description": "å…¬äº¤è½¦",
  "date": "2025-10-28",
  "time": "08:15:00"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "message": "äº¤æ˜“è®°å½•åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 3,
    "type": "expense",
    "amount": 30.00,
    "category": "äº¤é€š",
    "description": "å…¬äº¤è½¦",
    "date": "2025-10-28",
    "time": "08:15:00"
  }
}
```

---

### 4. PUT /api/transactions/{transaction_id}ï¼ˆæ›´æ–°äº¤æ˜“è®°å½•ï¼‰

**éœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼š**
- è·¯å¾„å‚æ•°ï¼š`transaction_id` (å¿…éœ€)
- è¯·æ±‚ä½“å­—æ®µï¼šå…¨éƒ¨å¯é€‰
  - `type`, `amount`, `category`, `description`, `date`, `time`
- å“åº”æ ¼å¼ï¼š`{"message": "...", "data": {...}}`
- é”™è¯¯ï¼š404 å¦‚æœä¸å­˜åœ¨æˆ–ä¸å±äºç”¨æˆ·

**å½“å‰å®ç°ï¼š**
- âœ… è·¯ç”±ï¼š`PUT /api/transactions/{transaction_id}`
- âœ… è·¯å¾„å‚æ•°ï¼š`transaction_id` (int)
- âœ… è¯·æ±‚ä½“éªŒè¯ï¼šæ‰€æœ‰å­—æ®µå¯é€‰ï¼ŒéªŒè¯è§„åˆ™ç›¸åŒ
- âœ… å“åº”æ ¼å¼ï¼š`{"message": "äº¤æ˜“è®°å½•æ›´æ–°æˆåŠŸ", "data": {...}}`
- âœ… é”™è¯¯å¤„ç†ï¼š404 "äº¤æ˜“è®°å½•ä¸å­˜åœ¨æˆ–ä¸å±äºå½“å‰ç”¨æˆ·"
- âœ… è®¤è¯ï¼šéœ€è¦Bearer Token
- âœ… ç”¨æˆ·éš”ç¦»ï¼šåªèƒ½æ›´æ–°è‡ªå·±çš„è®°å½•

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
  "amount": 50.00,
  "description": "æ›´æ–°åçš„æè¿°",
  "time": "14:30:00"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "message": "äº¤æ˜“è®°å½•æ›´æ–°æˆåŠŸ",
  "data": {
    "id": 1,
    "type": "expense",
    "amount": 50.00,
    "category": "é¤é¥®",
    "description": "æ›´æ–°åçš„æè¿°",
    "date": "2025-10-28",
    "time": "14:30:00"
  }
}
```

---

### 5. DELETE /api/transactions/{transaction_id}ï¼ˆåˆ é™¤äº¤æ˜“è®°å½•ï¼‰

**éœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼š**
- è·¯å¾„å‚æ•°ï¼š`transaction_id` (å¿…éœ€)
- å“åº”æ ¼å¼ï¼š`{"message": "...", "data": {"id": ..., "type": ..., "description": ...}}`
- é”™è¯¯ï¼š404 å¦‚æœä¸å­˜åœ¨æˆ–ä¸å±äºç”¨æˆ·

**å½“å‰å®ç°ï¼š**
- âœ… è·¯ç”±ï¼š`DELETE /api/transactions/{transaction_id}`
- âœ… è·¯å¾„å‚æ•°ï¼š`transaction_id` (int)
- âœ… å“åº”æ ¼å¼ï¼š`{"message": "äº¤æ˜“è®°å½•åˆ é™¤æˆåŠŸ", "data": {...}}`
  - dataåŒ…å«ï¼šid, type, description
- âœ… é”™è¯¯å¤„ç†ï¼š404 "äº¤æ˜“è®°å½•ä¸å­˜åœ¨æˆ–ä¸å±äºå½“å‰ç”¨æˆ·"
- âœ… è®¤è¯ï¼šéœ€è¦Bearer Token
- âœ… ç”¨æˆ·éš”ç¦»ï¼šåªèƒ½åˆ é™¤è‡ªå·±çš„è®°å½•

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "message": "äº¤æ˜“è®°å½•åˆ é™¤æˆåŠŸ",
  "data": {
    "id": 1,
    "type": "expense",
    "description": "åˆé¤"
  }
}
```

---

### 6. GET /api/finance/statsï¼ˆè·å–è´¢åŠ¡ç»Ÿè®¡ï¼‰

**éœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼š**
- æŸ¥è¯¢å‚æ•°ï¼š`month` (å¯é€‰ï¼ŒYYYY-MMï¼Œé»˜è®¤å½“å‰æœˆ)
- å“åº”æ ¼å¼ï¼š`{"data": {...}}`
- ç»Ÿè®¡å­—æ®µï¼š
  - `monthlyIncome`: å½“æœˆæ€»æ”¶å…¥
  - `monthlyExpense`: å½“æœˆæ€»æ”¯å‡º
  - `balance`: ç»“ä½™ = income - expense
  - `expenseByCategory`: æŒ‰ç±»åˆ«ç»Ÿè®¡æ”¯å‡ºæ•°ç»„

**å½“å‰å®ç°ï¼š**
- âœ… è·¯ç”±ï¼š`GET /api/finance/stats`
- âœ… æŸ¥è¯¢å‚æ•°ï¼š`month` (Optional[str], YYYY-MM)
- âœ… å“åº”æ ¼å¼ï¼š`{"data": {...}}`
- âœ… ç»Ÿè®¡è®¡ç®—ï¼š
  - âœ… monthlyIncome: æ‰€æœ‰incomeç±»å‹é‡‘é¢æ€»å’Œ
  - âœ… monthlyExpense: æ‰€æœ‰expenseç±»å‹é‡‘é¢æ€»å’Œ
  - âœ… balance: monthlyIncome - monthlyExpense
  - âœ… expenseByCategory: æŒ‰ç±»åˆ«èšåˆæ”¯å‡ºï¼ŒåŒ…å«categoryã€amountã€color
- âœ… ç±»åˆ«é¢œè‰²æ˜ å°„ï¼š
  - é¤é¥®: #ef4444
  - å­¦ä¹ : #3b82f6
  - äº¤é€š: #10b981
  - å¨±ä¹: #f59e0b
  - å…¼èŒ: #8b5cf6
  - å…¶ä»–: #6b7280
- âœ… è®¤è¯ï¼šéœ€è¦Bearer Token
- âœ… ç”¨æˆ·éš”ç¦»ï¼šåªç»Ÿè®¡å½“å‰ç”¨æˆ·çš„æ•°æ®

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "data": {
    "monthlyIncome": 2500.00,
    "monthlyExpense": 1800.00,
    "balance": 700.00,
    "expenseByCategory": [
      {
        "category": "é¤é¥®",
        "amount": 450.00,
        "color": "#ef4444"
      },
      {
        "category": "å­¦ä¹ ",
        "amount": 320.00,
        "color": "#3b82f6"
      }
    ]
  }
}
```

---

## âœ… å­—æ®µéªŒè¯å¯¹ç…§

### timeå­—æ®µ

**éœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼š**
- ç±»å‹ï¼šå¯é€‰ï¼ˆstring æˆ– nullï¼‰
- æ ¼å¼ï¼šHH:MM æˆ– HH:MM:SS
- å“åº”æ ¼å¼ï¼šHH:MM:SS æˆ– null

**å½“å‰å®ç°ï¼š**
- âœ… SchemaéªŒè¯ï¼šæ”¯æŒ HH:MM æˆ– HH:MM:SS æ ¼å¼
- âœ… æ•°æ®åº“å­—æ®µï¼š`time TIME NULL`
- âœ… å“åº”æ ¼å¼ï¼š`"time": "12:30:00"` æˆ– `"time": null`
- âœ… åˆ›å»º/æ›´æ–°ï¼šæ­£ç¡®å¤„ç†timeå­—æ®µè§£æ

---

## âœ… å®‰å…¨æ€§éªŒè¯

### ç”¨æˆ·è®¤è¯
- âœ… æ‰€æœ‰æ¥å£éƒ½éœ€è¦Bearer Tokenè®¤è¯
- âœ… ä½¿ç”¨ `get_current_user` ä¾èµ–æ³¨å…¥

### ç”¨æˆ·éš”ç¦»
- âœ… æ‰€æœ‰æŸ¥è¯¢éƒ½è¿‡æ»¤ `user_id = current_user.id`
- âœ… æ›´æ–°/åˆ é™¤æ“ä½œéªŒè¯ç”¨æˆ·å½’å±
- âœ… æ— æ³•è®¿é—®å…¶ä»–ç”¨æˆ·çš„æ•°æ®

### æ•°æ®éªŒè¯
- âœ… é‡‘é¢éªŒè¯ï¼š`gt=0` (å¿…é¡»å¤§äº0)
- âœ… ç±»å‹éªŒè¯ï¼šå¿…é¡»æ˜¯ income æˆ– expense
- âœ… æ—¥æœŸæ ¼å¼éªŒè¯ï¼šYYYY-MM-DD
- âœ… æ—¶é—´æ ¼å¼éªŒè¯ï¼šHH:MM æˆ– HH:MM:SS
- âœ… æè¿°é•¿åº¦éªŒè¯ï¼šæœ€å¤§255å­—ç¬¦

---

## âœ… é”™è¯¯å¤„ç†éªŒè¯

### çŠ¶æ€ç å¯¹ç…§

| é”™è¯¯ç±»å‹ | éœ€æ±‚æ–‡æ¡£è¦æ±‚ | å½“å‰å®ç° | çŠ¶æ€ |
|---------|------------|---------|------|
| å‚æ•°é”™è¯¯ | 400 | 400 | âœ… |
| æœªè®¤è¯ | 401 | 401 | âœ… |
| è®¿é—®å…¶ä»–ç”¨æˆ·æ•°æ® | 403 | 404ï¼ˆæ›´ä¸¥æ ¼ï¼‰ | âœ… |
| è®°å½•ä¸å­˜åœ¨ | 404 | 404 | âœ… |
| æ•°æ®éªŒè¯å¤±è´¥ | 422 | 400 | âš ï¸ |

**è¯´æ˜ï¼š**
- FastAPI è‡ªåŠ¨å°†éªŒè¯é”™è¯¯è¿”å›ä¸º422ï¼Œä½†å½“å‰ä½¿ç”¨ `HTTPException(status_code=400)` å¤„ç†ä¸šåŠ¡éªŒè¯é”™è¯¯
- è®¿é—®å…¶ä»–ç”¨æˆ·æ•°æ®æ—¶è¿”å›404è€Œä¸æ˜¯403æ˜¯æ›´å®‰å…¨çš„åšæ³•ï¼ˆä¸æš´éœ²è®°å½•å­˜åœ¨æ€§ï¼‰

### é”™è¯¯å“åº”æ ¼å¼

**éœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼š**
```json
{
  "detail": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

**å½“å‰å®ç°ï¼š**
- âœ… ä½¿ç”¨ FastAPI çš„ `HTTPException`ï¼Œè‡ªåŠ¨è¿”å› `{"detail": "..."}` æ ¼å¼

---

## âœ… è·¯ç”±æ³¨å†ŒéªŒè¯

**éœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼š**
- `/api/transactions` å¼€å¤´çš„è·¯ç”±
- `/api/finance` å¼€å¤´çš„è·¯ç”±

**å½“å‰å®ç°ï¼š**
- âœ… `finance.router` å‰ç¼€ï¼š`/api/transactions`
- âœ… `finance_stats.router` å‰ç¼€ï¼š`/api/finance`
- âœ… éƒ½åœ¨ `app/main.py` ä¸­æ­£ç¡®æ³¨å†Œ

---

## ğŸ“‹ æ€»ç»“

| é¡¹ç›® | éœ€æ±‚æ–‡æ¡£è¦æ±‚ | å½“å‰å®ç° | çŠ¶æ€ |
|-----|------------|---------|------|
| è·¯ç”±è·¯å¾„ | âœ… | âœ… | âœ… |
| è¯·æ±‚å‚æ•° | âœ… | âœ… | âœ… |
| å“åº”æ ¼å¼ | âœ… | âœ… | âœ… |
| å­—æ®µéªŒè¯ | âœ… | âœ… | âœ… |
| æ—¶é—´å­—æ®µ | âœ… | âœ… | âœ… |
| ç”¨æˆ·è®¤è¯ | âœ… | âœ… | âœ… |
| ç”¨æˆ·éš”ç¦» | âœ… | âœ… | âœ… |
| é”™è¯¯å¤„ç† | âœ… | âœ… | âœ… |
| è´¢åŠ¡ç»Ÿè®¡ | âœ… | âœ… | âœ… |

**ç»“è®ºï¼šâœ… æ‰€æœ‰è·¯ç”±å’Œè¯·æ±‚å¤„ç†éƒ½ç¬¦åˆéœ€æ±‚æ–‡æ¡£è¦æ±‚ï¼**


