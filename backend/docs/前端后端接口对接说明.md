# 前端后端接口对接说明

## ✅ 后端已支持的功能

### 1. 获取任务列表

**前端调用:**
```typescript
const response = await taskApi.getTasks({ limit: 100 })
// response.items 或 response.data.items
```

**后端接口:**
```http
GET /api/tasks?page=1&limit=100
```

**响应格式:**
```json
{
  "data": {
    "items": [
      {
        "id": 1,
        "title": "任务标题",
        "completed": false,
        "priority": "high",
        "date": "2025-10-29",
        "time": "09:00-11:00",
        "has_reminder": true,
        "reminder_time": "2025-10-29T08:00:00",
        "description": "任务描述",
        "created_at": "2025-10-28T10:00:00",
        "updated_at": "2025-10-28T10:00:00"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 100,
      "total": 10,
      "total_pages": 1,
      "has_next": false,
      "has_prev": false
    }
  }
}
```

**字段映射:**
- 后端返回: `has_reminder` (snake_case)
- 前端使用: `hasReminder` (camelCase)
- 处理方式: 前端需映射 `task.hasReminder = task.has_reminder`

### 2. 创建任务

**前端调用:**
```typescript
const newTask = await taskApi.addTask({
  title: "任务标题",
  date: "2025-10-29",
  priority: "high",
  hasReminder: true,
  reminder_time: "2025-10-29T08:00:00"
})
```

**后端接口:**
```http
POST /api/tasks
Content-Type: application/json
Authorization: Bearer {token}

{
  "title": "任务标题",
  "date": "2025-10-29",
  "priority": "high",
  "has_reminder": true,
  "reminder_time": "2025-10-29T08:00:00"
}
```

**字段映射要求:**
- 前端发送: `hasReminder` → 后端需接收 `has_reminder`
- 前端发送: `reminderTime` → 后端需接收られます `reminder_time`

**注意:** 前端需要将 camelCase 转换为 snake_case 再发送

### 3. 更新任务

**前端调用:**
```typescript
await taskApi.updateTask(id, {
  title: "新标题",
  hasReminder: false,
  reminder_time: null
})
```

**后端接口:**
```http
PUT /api/tasks/{task_id}
Content-Type: application/json
Authorization: Bearer {token}

{
  "title": "新标题",
  "has_reminder": false,
  "reminder_time": null
}
```

### 4. 删除单个任务

**前端调用:**
```typescript
await taskApi.deleteTask(id)
```

**后端接口:**
```http
DELETE /api/tasks/{task_id}
Authorization: Bearer {token}
```

**响应:**
```json
{
  "message": "任务删除成功",
  "data": {
    "id": 1,
    "title": "任务标题"
  }
}
```

### 5. 批量删除任务

**前端调用:**
```typescript
await taskApi.batchDeleteTasks([1, 2, 3])
```

**后端接口:**
```http
DELETE /api/tasks/batch
Content-Type: application/json
Authorization: Bearer {token}

{
  "task_ids": [1, 2, 3]
}
```

**响应:**
```json
{
  "message": "成功删除 3 个任务",
  "data": {
    "deleted_count": 3,
    "deleted_tasks": [
      {"id": 1, "title": "任务1"},
      {"id": 2, "title": "任务2"},
      {"id": 3, "title": "任务3"}
    ]
  }
}
```

### 6. 切换任务完成状态

**前端调用:**
```typescript
await taskApi.toggleTask(id)
// 或
await taskApi.updateTask(id, { completed: !task.completed })
```

**后端接口:**
```http
PATCH /api/tasks/{task_id}/toggle
Authorization: Bearer {token}
```

**响应:**
```json
{
  "data": {
    "id": 1,
    "title": "任务标题",
    "completed": true,
    ...
  }
}
```

## 📋 字段命名约定

### 后端 (snake_case)
- `has_reminder` - 是否有提醒
- `reminder_time` - 提醒时间
- `user_id` - 用户ID
- `created_at` - 创建时间
- `updated_at` - 更新时间

### 前端 (camelCase)
- `hasReminder` - 是否有提醒
- `reminderTime` - 提醒时间
- `userId` - 用户ID
- `createdAt` - 创建时间
- `updatedAt` - 更新时间

## 🔄 字段映射处理

### 前端发送数据时

```typescript
// 在 taskApi 中处理
const addTask = async (task: TaskCreate) => {
  // 转换字段名：camelCase → snake_case
  const requestData = {
    ...task,
    has_reminder: task.hasReminder,
    reminder_time: task.reminderTime,
    // 移除 camelCase 字段
    delete requestData.hasReminder
    delete requestData.reminderTime
  }
  
  return await request('/tasks', {
    method: 'POST',
    body: JSON.stringify(requestData)
  })
}
```

### 前端接收数据时

```typescript
// 在 taskApi 中处理
const getTasks = async () => {
  const response = await request('/tasks')
  
  // 转换字段名：snake_case → camelCase
  return response.items.map(task => ({
    ...task,
    hasReminder: task.has_reminder,
    reminderTime: task.reminder_time
  }))
}
```

## ✅ 验证清单

- [x] 后端支持单个删除任务
- [x] 后端支持批量删除任务  
- [x] 后端支持切换任务状态
- [x] 后端支持创建任务（含提醒字段）
- [x] 后端支持更新任务（含提醒字段）
- [x] 后端返回字段使用 snake_case
- [ ] 前端字段映射已实现（需前端检查）
- [ ] 前端 API 调用已更新（需前端检查）

## 🔍 测试建议

1. **测试删除功能:**
   ```bash
   curl -X DELETE "http://localhost:8000/api/tasks/1" \
     -H "Authorization: Bearer TOKEN"
   ```

2. **测试批量删除:**
   ```bash
   curl -X DELETE "http://localhost:8000/api/tasks/batch" \
     -H "Authorization: Bearer TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"task_ids": [1, 2, 3]}'
   ```

3. **测试切换状态:**
   ```bash
   curl -X PATCH "http://localhost:8000/api/tasks/1/toggle" \
     -H "Authorization: Bearer TOKEN"
   ```

